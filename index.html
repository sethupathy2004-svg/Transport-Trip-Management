<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Transport Trip Management System</title>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;600&family=Poppins:wght@400;500;600&display=swap');

        * { box-sizing: border-box; margin:0; padding:0; }

        body {
            font-family: 'Poppins', sans-serif;
            background: radial-gradient(circle at top, #0f2027, #203a43, #000000);
            padding: 20px;
        }

        .container {
            max-width: 950px;
            margin: 0 auto;
            padding: 40px;
            border-radius: 18px;
            background: rgba(255,255,255,0.95);
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        h2 {
            text-align:center;
            font-family:'Playfair Display', serif;
            font-size:28px;
            margin-bottom:40px;
        }

        .section { margin-bottom:30px; }

        .section h3 {
            font-size:13px;
            text-transform:uppercase;
            margin-bottom:12px;
            border-left:4px solid #bfa14a;
            padding-left:8px;
        }

        label { display:block; margin-top:12px; font-size:13px; }

        input {
            width:100%;
            padding:10px;
            margin-top:6px;
            border-radius:6px;
            border:1px solid #cbd5e1;
        }

        input[readonly] {
            background:#fff7d6;
            font-weight:600;
        }
        
        input:invalid {
            border:2px solid #ef4444;
        }

        input:invalid::placeholder {
            color:#ef4444;
            font-weight:500;
        }

        .buttons {
            text-align:center;
            margin-top:25px;
        }

        button {
            padding:12px 36px;
            border-radius:30px;
            border:none;
            cursor:pointer;
            font-weight:600;
        }

        button[type="submit"] {
            background: linear-gradient(135deg, #bfa14a, #f5d76e);
        }

        button.reset {
            margin-left:10px;
            background:#e5e7eb;
        }

        table {
            width:100%;
            border-collapse: collapse;
            margin-top:30px;
            font-size:12px;
        }

        th, td {
            padding:8px;
            text-align:center;
            border:1px solid #cbd5e1;
        }

        th {
            background:#f5d76e;
        }

        tr:hover {
            background:#fef9e7;
        }

        .action-cell {
            display:flex;
            justify-content:center;
            gap:6px;
        }

        button.edit {
            background:#60a5fa;
            padding:4px 8px;
            border-radius:4px;
        }

        button.delete {
            background:#f87171;
            padding:4px 8px;
            border-radius:4px;
        }
    </style>
</head>

<body>

<div class="container">
    <h2>Trip Details Form</h2>

    <form id="tripForm" novalidate>
        <div class="section">
            <h3>Trip Information</h3>

            <label>Trip Date</label>
            <input type="date" id="tripDate" required placeholder="Enter the Trip Date">

            <label>Vehicle Number</label>
            <input type="text" id="vehicleNumber" required placeholder="Enter the Vehicle Number">

            <label>Transport Name</label>
            <input type="text" id="transportName" required placeholder="Enter the Transport name">
        </div>

        <div class="section">
            <h3>Route Information</h3>

            <label>Source</label>
            <input type="text" id="source" required placeholder="Enter the Source">

            <label>Destination</label>
            <input type="text" id="destination" required placeholder="Enter the Destination">
        </div>

        <div class="section">
            <h3>Load & Price</h3>

            <label>Price Per Ton</label>
            <input type="number" id="pricePerTon" required placeholder="Enter the Price">

            <label>Load Weight</label>
            <input type="number" id="loadWeight" required placeholder="Enter the Load Weight">

            <label>Total Price</label>
            <input type="number" id="total" readonly>

            <label>Unload Weight</label>
            <input type="number" id="unloadWeight" required placeholder ="Enter the unload weight">
        </div>

        <div class="section">
            <h3>Payment</h3>

            <label>Advance Amount</label>
            <input type="number" id="advanceAmount" required placeholder="Enter The date of advance amount given ">

            <label>Advance Date</label>
            <input type="date" id="advanceDate" required placeholder="Enter advance date">

            <label>Advance Account No</label>
            <input type="text" id="advanceAccount" required placeholder="Enter A/c Number">

            <label>Balance</label>
            <input type="number" id="balance" readonly>

            <label>Balance Date</label>
            <input type="date" id="balanceDate" required placeholder="Enter the date of Balance completion">
        </div>

        <div class="buttons">
            <button type="submit">Submit</button>
            <button type="reset" class="reset">Reset</button>
        </div>
    </form>

    <h3>Trips List</h3>
    <table id="tripsTable">
        <thead>
            <tr>
                <th>ID</th>
                <th>Date</th>
                <th>Vehicle</th>
                <th>Transport</th>
                <th>Source</th>
                <th>Destination</th>
                <th>Price/Ton</th>
                <th>Load</th>
                <th>Unload</th>
                <th>Total</th>
                <th>Advance</th>
                <th>Balance</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<script>
    const tripForm = document.getElementById("tripForm");
    const tripsTableBody = document.querySelector("#tripsTable tbody");
    const tripDate = document.getElementById("tripDate");
    const vehicleNumber = document.getElementById("vehicleNumber");
    const transportName = document.getElementById("transportName");
    const source = document.getElementById("source");
    const destination = document.getElementById("destination");
    const pricePerTon = document.getElementById("pricePerTon");
    const loadWeight = document.getElementById("loadWeight");
    const unloadWeight = document.getElementById("unloadWeight");
    const total = document.getElementById("total");
    const advanceAmount = document.getElementById("advanceAmount");
    const advanceDate = document.getElementById("advanceDate");
    const advanceAccount = document.getElementById("advanceAccount");
    const balance = document.getElementById("balance");
    const balanceDate = document.getElementById("balanceDate");

    let editingTripId = null;
    // validation message 
    document.querySelectorAll("input[required]").forEach(input => {
        input.addEventListener("invalid", () => {
            input.setCustomValidity("Enter the data");
        });
        input.addEventListener("input", () => {
            input.setCustomValidity("");
        });
    });

    function calculateTotals() {
        const price = +pricePerTon.value || 0;
        const weight = +loadWeight.value || 0;
        const advance = +advanceAmount.value || 0;

        total.value = price * weight;
        balance.value = total.value - advance;
    }

    pricePerTon.oninput = calculateTotals;
    loadWeight.oninput = calculateTotals;
    advanceAmount.oninput = calculateTotals;

    function addTripToTable(trip) {
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${trip.id}</td>
            <td>${trip.tripDate}</td>
            <td>${trip.vehicleNumber}</td>
            <td>${trip.transportName}</td>
            <td>${trip.source}</td>
            <td>${trip.destination}</td>
            <td>${trip.pricePerTon}</td>
            <td>${trip.loadWeight}</td>
            <td>${trip.unloadWeight}</td>
            <td>${trip.total}</td>
            <td>${trip.advanceAmount}</td>
            <td>${trip.balance}</td>
            <td class="action-cell">
                <button class="edit">Edit</button>
                <button class="delete">Delete</button>
            </td>
            `;
        tripsTableBody.appendChild(row);

        row.querySelector(".edit").onclick = () => editTrip(trip);
        row.querySelector(".delete").onclick = () => deleteTrip(trip.id);
    }

    function loadAllTrips() {
        fetch("http://localhost:8080/api/trips")
            .then(res => res.json())
            .then(data => {
                tripsTableBody.innerHTML = "";
                data.forEach(addTripToTable);
            });
    }

    function deleteTrip(id) {
        fetch(`http://localhost:8080/api/trips/${id}`, {
            method: "DELETE"
        }).then(loadAllTrips);
    }

    function editTrip(trip) {
        editingTripId = trip.id;

        tripDate.value = trip.tripDate;
        vehicleNumber.value = trip.vehicleNumber;
        transportName.value = trip.transportName;
        source.value = trip.source;
        destination.value = trip.destination;
        pricePerTon.value = trip.pricePerTon;
        loadWeight.value = trip.loadWeight;
        unloadWeight.value = trip.unloadWeight;
        total.value = trip.total;
        advanceAmount.value = trip.advanceAmount;
        advanceDate.value = trip.advanceDate;
        advanceAccount.value = trip.advanceAccount;
        balance.value = trip.balance;
        balanceDate.value = trip.balanceDate;
    }

    tripForm.onsubmit = function (e) {
        e.preventDefault();

        if (!tripForm.checkValidity()) {
            tripForm.reportValidity();
            return;
        }

        const tripData = {
            tripDate: tripDate.value,
            vehicleNumber: vehicleNumber.value,
            transportName: transportName.value,
            source: source.value,
            destination: destination.value,
            pricePerTon: +pricePerTon.value,
            loadWeight: +loadWeight.value,
            unloadWeight: +unloadWeight.value,
            total: +total.value,
            advanceAmount: +advanceAmount.value,
            advanceDate: advanceDate.value,
            advanceAccount: advanceAccount.value,
            balance: +balance.value,
            balanceDate: balanceDate.value
        };

        const url = editingTripId ? `http://localhost:8080/api/trips/${editingTripId}` : "http://localhost:8080/api/trips";

        const method = editingTripId ? "PUT" : "POST";

        fetch(url, {  method,  headers: { "Content-Type": "application/json" }, body: JSON.stringify(tripData) })
            .then(() => {
            editingTripId = null;
            tripForm.reset();
            total.value = "";
            balance.value = "";
            loadAllTrips();
        });
    };

    window.onload = loadAllTrips;
</script>



</body>
</html>
