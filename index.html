<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Transport Trip Management System</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap');

*{box-sizing:border-box;margin:0;padding:0}

body{
font-family:Poppins,sans-serif;
background:radial-gradient(circle at top,#0f2027,#203a43,#000);
padding:20px;
}

.container{
max-width:1100px;
margin:auto;
background:white;
padding:25px;
border-radius:16px;
box-shadow:0 20px 60px rgba(0,0,0,0.4);
}

h2{text-align:center;margin-bottom:20px}

button{
padding:10px 20px;
border:none;
border-radius:20px;
cursor:pointer;
font-weight:600;
}

.add-btn{background:linear-gradient(135deg,#facc15,#f59e0b);}
.cancel{background:#e5e7eb}
.export{background:#4ade80}

input, textarea{
padding:8px;
border-radius:6px;
border:1px solid #ccc;
width:100%;
}

textarea{
resize:none;
min-height:100px;
padding:12px;
box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);
transition: border 0.3s, box-shadow 0.3s;
}

textarea:focus{
border-color:#f59e0b;
box-shadow:0 0 5px rgba(245,158,11,0.4);
outline:none;
}

label{font-size:13px;margin-top:10px;display:block}

.form-grid{
display:grid;
grid-template-columns:1fr 1fr;
gap:20px;
}

@media(max-width:768px){
.form-grid{grid-template-columns:1fr}
}

.section{border:1px solid #ddd;padding:15px;border-radius:10px;margin-bottom:15px}

table{
width:100%;
border-collapse:collapse;
margin-top:15px;
font-size:12px;
}

th,td{
border:1px solid #ddd;
padding:8px;
text-align:center;
}

th{background:#facc15}

.actions button{padding:4px 10px;font-size:12px}
.edit{background:#60a5fa}
.delete{background:#f87171}

.filters{
display:flex;
gap:10px;
margin-bottom:15px;
flex-wrap:wrap;
}
</style>
</head>

<body>

<div class="container">
<h2>ðŸš› Transport Trip Management</h2>

<!-- TABLE VIEW -->
<div id="tableView">

<div class="filters">
<input type="text" id="searchBox" placeholder="Search vehicle / transport">
<input type="date" id="filterDate">
<button class="export" onclick="exportExcel()">Export Excel</button>
<button class="add-btn" onclick="openForm()">âž• Add Trip</button>
</div>

<table id="tripTable">
<thead>
<tr>
<th>ID</th><th>Date</th><th>Vehicle</th><th>Transport</th>
<th>Source</th><th>Destination</th><th>Total</th>
<th>Advance</th><th>Balance</th><th>Action</th>
</tr>
</thead>
<tbody></tbody>
</table>
</div>

<!-- FORM VIEW -->
<div id="formView" style="display:none">

<form id="tripForm" novalidate>

<div class="form-grid">

<div class="section">
<h3>Trip Information</h3>
<label>Trip Date</label>
<input type="date" id="tripDate" required>

<label>Vehicle Number</label>
<input id="vehicleNumber" required>

<label>Transport Name</label>
<input id="transportName" required>
</div>

<div class="section">
<h3>Route</h3>
<label>Source</label>
<input id="source" required>

<label>Destination</label>
<input id="destination" required>
</div>

<div class="section">
<h3>Load & Price</h3>
<label>Price Per Ton</label>
<input type="number" id="pricePerTon" required>

<label>Load Weight</label>
<input type="number" id="loadWeight" step="0.001" min="0" required>

<label>Total</label>
<input id="total" readonly>

<label>Unload Weight</label>
<input type="number" id="unloadWeight" step="0.001" min="0">
</div>

<div class="section">
<h3>Payment</h3>
<label>Payment Details</label>
<textarea id="paymentdetails" placeholder="Enter the Payment Details"></textarea>
<label>Advance Amount</label>
<input type="number" id="advanceAmount" required>

<label>Balance</label>
<input id="balance" readonly>
</div>

<!-- Feedback Section -->
<div class="section">
<h3>Feedback</h3>
<label>Feedback / Notes</label>
<textarea id="feedback" placeholder="Enter any feedback or notes here"></textarea>
</div>

</div>

<div style="text-align:center;margin-top:20px">
<button class="add-btn" type="submit">Save</button>
<button type="button" class="cancel" onclick="openTable()">Cancel</button>
</div>

</form>
</div>

</div>

<script>
let trips = JSON.parse(localStorage.getItem("trips")||"[]");
let editId = null;

const tableBody = document.querySelector("#tripTable tbody");
const formView = document.getElementById("formView");
const tableView = document.getElementById("tableView");
const tripForm = document.getElementById("tripForm");

function openForm(){
    formView.style.display="block";
    tableView.style.display="none";
}

function openTable(){
    formView.style.display="none";
    tableView.style.display="block";
    loadTable();
}

/* Auto calculation */
pricePerTon.oninput = loadWeight.oninput = unloadWeight.oninput = advanceAmount.oninput = () => {
    const load = +loadWeight.value || 0;
    const unload = +unloadWeight.value || 0;
    const price = +pricePerTon.value || 0;

    const delivered = Math.max(load - unload, 0);
    const totalCalc = delivered * price;

    total.value = totalCalc.toFixed(2);
    balance.value = (totalCalc - (+advanceAmount.value || 0)).toFixed(2);
};

/* Validation before saving */
tripForm.onsubmit = e => {
    e.preventDefault();

    if (!tripDate.value || !vehicleNumber.value.trim() || !transportName.value.trim() ||
        !source.value.trim() || !destination.value.trim() ||
        !pricePerTon.value || !loadWeight.value || !advanceAmount.value) {
        alert("Please fill all required fields before saving!");
        return;
    }

    const data = {
        id: editId || Date.now(),
        date: tripDate.value,
        vehicle: vehicleNumber.value.trim(),
        transport: transportName.value.trim(),
        source: source.value.trim(),
        dest: destination.value.trim(),
        pricePerTon: pricePerTon.value,
        loadWeight: loadWeight.value,
        unloadWeight: unloadWeight.value,
        total: total.value,
        advance: advanceAmount.value,
        balance: balance.value,
        paymentdetails: paymentdetails.value.trim(),
        feedback: feedback.value.trim()
    };

    if (editId) {
        trips = trips.map(t => t.id === editId ? data : t);
    } else {
        trips.push(data);
    }

    localStorage.setItem("trips", JSON.stringify(trips));
    editId = null;
    tripForm.reset();
    openTable();
};

function loadTable(){
    tableBody.innerHTML = "";
    const search = searchBox.value.toLowerCase();
    const date = filterDate.value;

    trips.filter(t=>{
        return (!search || t.vehicle.toLowerCase().includes(search) || t.transport.toLowerCase().includes(search))
            && (!date || t.date === date);
    }).forEach(t=>{
        tableBody.innerHTML += `
        <tr>
        <td>${t.id}</td><td>${t.date}</td><td>${t.vehicle}</td><td>${t.transport}</td>
        <td>${t.source}</td><td>${t.dest}</td><td>${t.total}</td>
        <td>${t.advance}</td><td>${t.balance}</td>
        <td class="actions">
        <button class="edit" onclick="editTrip(${t.id})">Edit</button>
        <button class="delete" onclick="deleteTrip(${t.id})">Del</button>
        </td>
        </tr>`;
    });
}

function editTrip(id){
    const t = trips.find(x => x.id === id);
    editId = id;

    tripDate.value = t.date;
    vehicleNumber.value = t.vehicle;
    transportName.value = t.transport;
    source.value = t.source;
    destination.value = t.dest;

    pricePerTon.value = t.pricePerTon;
    loadWeight.value = t.loadWeight;
    unloadWeight.value = t.unloadWeight;

    total.value = t.total;
    advanceAmount.value = t.advance;
    balance.value = t.balance;
    paymentdetails.value = t.paymentdetails || '';
    feedback.value = t.feedback || '';

    openForm();
}

function deleteTrip(id){
    const confirmDelete = confirm("Are you sure you want to delete this trip?");
    if (!confirmDelete) return;

    trips = trips.filter(t => t.id !== id);
    localStorage.setItem("trips", JSON.stringify(trips));
    loadTable();
}

function exportExcel(){
    let csv="Date,Vehicle,Transport,Source,Destination,Total,Advance,Balance\n";
    trips.forEach(t=>{
        csv+=`'${t.date}',${t.vehicle},${t.transport},${t.source},${t.dest},${t.total},${t.advance},${t.balance}\n`;
    });
    const blob=new Blob([csv],{type:"text/csv"});
    const a=document.createElement("a");
    a.href=URL.createObjectURL(blob);
    a.download="trips.csv";
    a.click();
}

searchBox.oninput = filterDate.onchange = loadTable;

openTable();
</script>

</body>
</html>
